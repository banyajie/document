[TOC]



### ACID

- 原子性

- 一致性

- 隔离性

- 永久性

    

### CAP

- 一致性
- 可用性
- 分区可容忍性
- 

### base理论 - 解决CAP提出的分布式系统一致性、可用性不能兼得的问题

- BA：Basically Available 基本可用
- S：soft state 软状态，状态可以在一段时间内不同步
- E：Eventually Consistent 最终一致，在一定的时间窗口内，最终数据达成一致即可
- 

### DTS（分布式事务处理模型）

- 应用程序
- 事务管理器
- 资源管理器
- 通信资源管理器
- 

### 两段提交协议

- 准备阶段 （事务管理器向资源管理器发起指令，资源管理器评估自己的状态，如果资源管理器评估指令可以完成，则会写redo、undo log，然后锁定资源，并不提交）
- 
- 提交阶段（如果每个资源管理器明确返回准备成功，则事务管理器向资源管理器发起提交指令，资源管理器提交资源变更的事务，释放锁定的资源。如果任意一个资源管理器返回准备失败，则事务管理器向所有的资源管理器发起终止指令，资源管理器取消已经变更的事务，执行undo日志，释放锁定的资源）

##### 优点、缺点

- 优点：保证强一致性
- 缺点：
  - 阻塞
  - 单点故障
  - 脑裂

#### 三段提交协议

- 询问阶段：可以确保尽可能的早的发现无法执行操作而需要中止的行为，但是它并不能发现所有的行为，只是尽可能减少这种情况的发生
- 
- 准备阶段
- 提交阶段
- 
##### 和两段式提交的不同点

- 准备阶段、提交阶段都增加了超时，一旦超时，则事务管理、资源管理都会继续提交事务，默认成功
- 还是有数据不一致的情况发生

### 阿里巴巴（TCC）

- try
- confirm
- cancel



### 保证最终一致性的模式
- 查询模式
    - 根据查询服务的当前状态做出相应的动作
- 补偿模式
    - 自动恢复
    - 运营
    - 技术运营
- 异步确保模式
- 定期校对模式
- 可靠消息模式
    - 消息的可靠发送
    - 消息处理器的幂等性
    - 
    - 


### 超时处理模式
- 同步调用
- 异步调用
- 消息队列异步处理
- 


### 迁移开关的设计

推荐使用订单式开关